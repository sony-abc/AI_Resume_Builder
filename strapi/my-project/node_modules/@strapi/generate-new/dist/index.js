"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const node_path = require("node:path");
const node_fs = require("node:fs");
const os = require("node:os");
const readline = require("node:readline");
const crypto = require("crypto");
const checkRequirements = require("./utils/check-requirements.js");
const usage = require("./utils/usage.js");
const machineId = require("./utils/machine-id.js");
const checkInstallPath = require("./utils/check-install-path.js");
const createProject = require("./create-project.js");
const database = require("./utils/database.js");
const _interopDefault = (e) => e && e.__esModule ? e : { default: e };
const os__default = /* @__PURE__ */ _interopDefault(os);
const readline__default = /* @__PURE__ */ _interopDefault(readline);
const crypto__default = /* @__PURE__ */ _interopDefault(crypto);
const packageJson = JSON.parse(node_fs.readFileSync(node_path.resolve(__dirname, "../package.json"), "utf8"));
const generateNewApp = async (options) => {
  checkRequirements();
  const rootPath = await checkInstallPath(options.directory);
  const tmpPath = node_path.join(os__default.default.tmpdir(), `strapi${crypto__default.default.randomBytes(6).toString("hex")}`);
  const scope = {
    rootPath,
    name: node_path.basename(rootPath),
    useTypescript: options.useTypescript,
    packageManager: options.packageManager,
    database: options.database,
    runApp: options.runApp ?? false,
    isQuickstart: options.isQuickstart,
    // use package version as strapiVersion (all packages have the same version);
    strapiVersion: packageJson.version,
    template: options.template,
    packageJsonStrapi: {
      template: options.template
    },
    uuid: (process.env.STRAPI_UUID_PREFIX || "") + crypto__default.default.randomUUID(),
    docker: process.env.DOCKER === "true",
    deviceId: machineId(),
    tmpPath,
    installDependencies: true,
    devDependencies: {},
    dependencies: {
      "@strapi/strapi": packageJson.version,
      "@strapi/plugin-users-permissions": packageJson.version,
      "@strapi/plugin-cloud": packageJson.version,
      // third party
      react: "^18.0.0",
      "react-dom": "^18.0.0",
      "react-router-dom": "^6.0.0",
      "styled-components": "^6.0.0"
    }
  };
  if (scope.useTypescript) {
    scope.devDependencies = {
      ...scope.devDependencies,
      typescript: "^5",
      "@types/node": "^20",
      "@types/react": "^18",
      "@types/react-dom": "^18"
    };
  }
  database.addDatabaseDependencies(scope);
  initCancelCatcher();
  try {
    await usage.trackUsage({ event: "willCreateProject", scope });
    return await createProject(scope);
  } catch (error) {
    if (!(error instanceof Error)) {
      throw error;
    }
    console.log(`
${error.message}
`);
    return usage.trackError({ scope, error }).then(() => {
      process.exit(1);
    });
  }
};
function initCancelCatcher() {
  if (process.platform === "win32") {
    const rl = readline__default.default.createInterface({
      input: process.stdin,
      output: process.stdout
    });
    rl.on("SIGINT", function sigint() {
      process.emit("SIGINT");
    });
  }
  process.on("SIGINT", () => {
    process.exit(1);
  });
}
exports.checkRequirements = checkRequirements;
exports.checkInstallPath = checkInstallPath;
exports.generateNewApp = generateNewApp;
//# sourceMappingURL=index.js.map
