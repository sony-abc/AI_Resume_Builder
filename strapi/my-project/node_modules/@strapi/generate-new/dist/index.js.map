{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { join, resolve, basename } from 'node:path';\nimport { readFileSync } from 'node:fs';\nimport os from 'node:os';\nimport readline from 'node:readline';\nimport crypto from 'crypto';\n\nimport checkRequirements from './utils/check-requirements';\nimport { trackError, trackUsage } from './utils/usage';\nimport machineID from './utils/machine-id';\nimport type { Scope, Options } from './types';\n\nimport checkInstallPath from './utils/check-install-path';\nimport createProject from './create-project';\nimport { addDatabaseDependencies } from './utils/database';\n\nexport type { Options };\nexport { default as checkInstallPath } from './utils/check-install-path';\nexport { default as checkRequirements } from './utils/check-requirements';\n\nconst packageJson = JSON.parse(readFileSync(resolve(__dirname, '../package.json'), 'utf8'));\n\nexport const generateNewApp = async (options: Options) => {\n  checkRequirements();\n\n  const rootPath = await checkInstallPath(options.directory);\n\n  const tmpPath = join(os.tmpdir(), `strapi${crypto.randomBytes(6).toString('hex')}`);\n\n  const scope: Scope = {\n    rootPath,\n    name: basename(rootPath),\n    useTypescript: options.useTypescript,\n    packageManager: options.packageManager,\n    database: options.database,\n    runApp: options.runApp ?? false,\n    isQuickstart: options.isQuickstart,\n    // use package version as strapiVersion (all packages have the same version);\n    strapiVersion: packageJson.version,\n    template: options.template,\n    packageJsonStrapi: {\n      template: options.template,\n    },\n    uuid: (process.env.STRAPI_UUID_PREFIX || '') + crypto.randomUUID(),\n    docker: process.env.DOCKER === 'true',\n    deviceId: machineID(),\n    tmpPath,\n    installDependencies: true,\n    devDependencies: {},\n    dependencies: {\n      '@strapi/strapi': packageJson.version,\n      '@strapi/plugin-users-permissions': packageJson.version,\n      '@strapi/plugin-cloud': packageJson.version,\n      // third party\n      react: '^18.0.0',\n      'react-dom': '^18.0.0',\n      'react-router-dom': '^6.0.0',\n      'styled-components': '^6.0.0',\n    },\n  };\n\n  if (scope.useTypescript) {\n    scope.devDependencies = {\n      ...scope.devDependencies,\n      typescript: '^5',\n      '@types/node': '^20',\n      '@types/react': '^18',\n      '@types/react-dom': '^18',\n    };\n  }\n\n  addDatabaseDependencies(scope);\n\n  initCancelCatcher();\n\n  try {\n    await trackUsage({ event: 'willCreateProject', scope });\n\n    // create a project with full list of questions\n    return await createProject(scope);\n  } catch (error) {\n    if (!(error instanceof Error)) {\n      throw error;\n    }\n\n    console.log(`\\n${error.message}\\n`);\n\n    return trackError({ scope, error }).then(() => {\n      process.exit(1);\n    });\n  }\n};\n\nfunction initCancelCatcher() {\n  // Create interface for windows user to let them quit the program.\n  if (process.platform === 'win32') {\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    });\n\n    rl.on('SIGINT', function sigint() {\n      process.emit('SIGINT');\n    });\n  }\n\n  process.on('SIGINT', () => {\n    process.exit(1);\n  });\n}\n"],"names":["readFileSync","resolve","join","os","crypto","basename","machineID","addDatabaseDependencies","trackUsage","trackError","readline"],"mappings":";;;;;;;;;;;;;;;;;AAmBA,MAAM,cAAc,KAAK,MAAMA,qBAAaC,UAAAA,QAAQ,WAAW,iBAAiB,GAAG,MAAM,CAAC;AAE7E,MAAA,iBAAiB,OAAO,YAAqB;AACtC;AAElB,QAAM,WAAW,MAAM,iBAAiB,QAAQ,SAAS;AAEzD,QAAM,UAAUC,UAAA,KAAKC,YAAG,QAAA,OAAA,GAAU,SAASC,gBAAO,QAAA,YAAY,CAAC,EAAE,SAAS,KAAK,CAAC,EAAE;AAElF,QAAM,QAAe;AAAA,IACnB;AAAA,IACA,MAAMC,mBAAS,QAAQ;AAAA,IACvB,eAAe,QAAQ;AAAA,IACvB,gBAAgB,QAAQ;AAAA,IACxB,UAAU,QAAQ;AAAA,IAClB,QAAQ,QAAQ,UAAU;AAAA,IAC1B,cAAc,QAAQ;AAAA;AAAA,IAEtB,eAAe,YAAY;AAAA,IAC3B,UAAU,QAAQ;AAAA,IAClB,mBAAmB;AAAA,MACjB,UAAU,QAAQ;AAAA,IACpB;AAAA,IACA,OAAO,QAAQ,IAAI,sBAAsB,MAAMD,wBAAO,WAAW;AAAA,IACjE,QAAQ,QAAQ,IAAI,WAAW;AAAA,IAC/B,UAAUE,UAAU;AAAA,IACpB;AAAA,IACA,qBAAqB;AAAA,IACrB,iBAAiB,CAAC;AAAA,IAClB,cAAc;AAAA,MACZ,kBAAkB,YAAY;AAAA,MAC9B,oCAAoC,YAAY;AAAA,MAChD,wBAAwB,YAAY;AAAA;AAAA,MAEpC,OAAO;AAAA,MACP,aAAa;AAAA,MACb,oBAAoB;AAAA,MACpB,qBAAqB;AAAA,IACvB;AAAA,EAAA;AAGF,MAAI,MAAM,eAAe;AACvB,UAAM,kBAAkB;AAAA,MACtB,GAAG,MAAM;AAAA,MACT,YAAY;AAAA,MACZ,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,oBAAoB;AAAA,IAAA;AAAA,EAExB;AAEAC,WAAA,wBAAwB,KAAK;AAEX;AAEd,MAAA;AACF,UAAMC,MAAW,WAAA,EAAE,OAAO,qBAAqB,MAAO,CAAA;AAG/C,WAAA,MAAM,cAAc,KAAK;AAAA,WACzB,OAAO;AACV,QAAA,EAAE,iBAAiB,QAAQ;AACvB,YAAA;AAAA,IACR;AAEA,YAAQ,IAAI;AAAA,EAAK,MAAM,OAAO;AAAA,CAAI;AAElC,WAAOC,MAAAA,WAAW,EAAE,OAAO,OAAO,EAAE,KAAK,MAAM;AAC7C,cAAQ,KAAK,CAAC;AAAA,IAAA,CACf;AAAA,EACH;AACF;AAEA,SAAS,oBAAoB;AAEvB,MAAA,QAAQ,aAAa,SAAS;AAC1B,UAAA,KAAKC,0BAAS,gBAAgB;AAAA,MAClC,OAAO,QAAQ;AAAA,MACf,QAAQ,QAAQ;AAAA,IAAA,CACjB;AAEE,OAAA,GAAG,UAAU,SAAS,SAAS;AAChC,cAAQ,KAAK,QAAQ;AAAA,IAAA,CACtB;AAAA,EACH;AAEQ,UAAA,GAAG,UAAU,MAAM;AACzB,YAAQ,KAAK,CAAC;AAAA,EAAA,CACf;AACH;;;;"}