{"version":3,"file":"generate.mjs","sources":["../../../../src/cli/commands/templates/generate.ts"],"sourcesContent":["import { createCommand } from 'commander';\nimport { resolve, join, basename } from 'path';\nimport fse from 'fs-extra';\nimport chalk from 'chalk';\nimport inquirer from 'inquirer';\n\nimport type { StrapiCommand } from '../../types';\nimport { runAction } from '../../utils/helpers';\n\n// All directories that a template could need\nconst TEMPLATE_CONTENT = ['src', 'data'];\n\nasync function copyContent(templatePath: string, rootBase: string) {\n  for (const item of TEMPLATE_CONTENT) {\n    try {\n      const pathToCopy = join(process.cwd(), item);\n\n      if (!(await fse.pathExists(pathToCopy))) {\n        continue;\n      }\n\n      await fse.copy(pathToCopy, join(templatePath, item));\n      const currentProjectBase = basename(process.cwd());\n      console.log(\n        `${chalk.green(\n          'success'\n        )}: copy ${currentProjectBase}/${item} => ${rootBase}/template/${item}`\n      );\n    } catch (error) {\n      if (error instanceof Error) {\n        console.error(`${chalk.red('error')}: ${error.message}`);\n      }\n    }\n  }\n}\n\n/**\n *\n * @param {string} rootPath Absolute path to the root directory\n */\nasync function writeTemplateJson(rootPath: string) {\n  try {\n    await fse.writeJSON(join(rootPath, 'template.json'), {});\n    console.log(`${chalk.green('success')}: create JSON config file`);\n  } catch (error) {\n    if (error instanceof Error) {\n      console.error(`${chalk.red('error')}: ${error.message}`);\n    }\n  }\n}\n\n/**\n *\n * @param {string} rootPath Absolute path to the root directory\n * @returns boolean\n */\nasync function templateConfigExists(rootPath: string) {\n  const configExists = await fse.pathExists(join(rootPath, 'template.json'));\n  console.log(`checking: ${join(rootPath, 'template.json')}. result ${configExists}`);\n  return configExists;\n}\n\nconst action = async function generateTemplate(directory: string) {\n  const rootPath = resolve(directory);\n\n  // Get path to template directory: <rootPath>/template\n  const templatePath = join(rootPath, 'template');\n\n  // Check if the template directory exists\n  const exists = await fse.pathExists(templatePath);\n  const rootBase = basename(rootPath);\n\n  if (exists) {\n    // Confirm the user wants to replace the existing template\n    const inquiry = await inquirer.prompt({\n      type: 'confirm',\n      name: 'confirm',\n      message: `${chalk.yellow(rootBase)} already exists.  Do you want to replace it?`,\n    });\n\n    if (!inquiry.confirm) {\n      process.exit(0);\n    }\n  }\n\n  // Create or replace root directory with <roothPath>/template\n  await fse.ensureDir(templatePath);\n  // Copy content to /template\n  await copyContent(templatePath, rootBase);\n  // Create config file if it doesn't exist\n  const configExists = await templateConfigExists(rootPath);\n  if (!configExists) {\n    await writeTemplateJson(rootPath);\n  }\n\n  console.log(`${chalk.green('success')}: generated template at ${chalk.yellow(rootPath)}`);\n};\n\n/**\n *`$ strapi templates:generate <directory>`\n */\nconst command: StrapiCommand = () => {\n  return createCommand('templates:generate <directory>')\n    .description('Generate template from Strapi project')\n    .action(runAction('templates:generate', action));\n};\n\nexport { action, command };\n"],"names":[],"mappings":";;;;;;AAUA,MAAM,mBAAmB,CAAC,OAAO,MAAM;AAEvC,eAAe,YAAY,cAAsB,UAAkB;AACjE,aAAW,QAAQ,kBAAkB;AAC/B,QAAA;AACF,YAAM,aAAa,KAAK,QAAQ,OAAO,IAAI;AAE3C,UAAI,CAAE,MAAM,IAAI,WAAW,UAAU,GAAI;AACvC;AAAA,MACF;AAEA,YAAM,IAAI,KAAK,YAAY,KAAK,cAAc,IAAI,CAAC;AACnD,YAAM,qBAAqB,SAAS,QAAQ,IAAK,CAAA;AACzC,cAAA;AAAA,QACN,GAAG,MAAM;AAAA,UACP;AAAA,QAAA,CACD,UAAU,kBAAkB,IAAI,IAAI,OAAO,QAAQ,aAAa,IAAI;AAAA,MAAA;AAAA,aAEhE,OAAO;AACd,UAAI,iBAAiB,OAAO;AAClB,gBAAA,MAAM,GAAG,MAAM,IAAI,OAAO,CAAC,KAAK,MAAM,OAAO,EAAE;AAAA,MACzD;AAAA,IACF;AAAA,EACF;AACF;AAMA,eAAe,kBAAkB,UAAkB;AAC7C,MAAA;AACF,UAAM,IAAI,UAAU,KAAK,UAAU,eAAe,GAAG,CAAA,CAAE;AACvD,YAAQ,IAAI,GAAG,MAAM,MAAM,SAAS,CAAC,2BAA2B;AAAA,WACzD,OAAO;AACd,QAAI,iBAAiB,OAAO;AAClB,cAAA,MAAM,GAAG,MAAM,IAAI,OAAO,CAAC,KAAK,MAAM,OAAO,EAAE;AAAA,IACzD;AAAA,EACF;AACF;AAOA,eAAe,qBAAqB,UAAkB;AACpD,QAAM,eAAe,MAAM,IAAI,WAAW,KAAK,UAAU,eAAe,CAAC;AACjE,UAAA,IAAI,aAAa,KAAK,UAAU,eAAe,CAAC,YAAY,YAAY,EAAE;AAC3E,SAAA;AACT;AAEM,MAAA,SAAS,eAAe,iBAAiB,WAAmB;AAC1D,QAAA,WAAW,QAAQ,SAAS;AAG5B,QAAA,eAAe,KAAK,UAAU,UAAU;AAG9C,QAAM,SAAS,MAAM,IAAI,WAAW,YAAY;AAC1C,QAAA,WAAW,SAAS,QAAQ;AAElC,MAAI,QAAQ;AAEJ,UAAA,UAAU,MAAM,SAAS,OAAO;AAAA,MACpC,MAAM;AAAA,MACN,MAAM;AAAA,MACN,SAAS,GAAG,MAAM,OAAO,QAAQ,CAAC;AAAA,IAAA,CACnC;AAEG,QAAA,CAAC,QAAQ,SAAS;AACpB,cAAQ,KAAK,CAAC;AAAA,IAChB;AAAA,EACF;AAGM,QAAA,IAAI,UAAU,YAAY;AAE1B,QAAA,YAAY,cAAc,QAAQ;AAElC,QAAA,eAAe,MAAM,qBAAqB,QAAQ;AACxD,MAAI,CAAC,cAAc;AACjB,UAAM,kBAAkB,QAAQ;AAAA,EAClC;AAEQ,UAAA,IAAI,GAAG,MAAM,MAAM,SAAS,CAAC,2BAA2B,MAAM,OAAO,QAAQ,CAAC,EAAE;AAC1F;AAKA,MAAM,UAAyB,MAAM;AAC5B,SAAA,cAAc,gCAAgC,EAClD,YAAY,uCAAuC,EACnD,OAAO,UAAU,sBAAsB,MAAM,CAAC;AACnD;"}